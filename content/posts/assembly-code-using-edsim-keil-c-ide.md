---
author: amrithmmh
cover:
  alt: Screenshot 2022-09-18 151525
  image: /wp-content/uploads/2022/09/screenshot-2022-09-18-151525.png
date: "2022-09-18T08:57:43+00:00"
guid: https://armphibian.wordpress.com/?p=276
tag:
  - "8051"
  - assembly
  - edsim51
  - microcontroller
title: 8051 assembly code(using edsim51/keil C51 IDE)
url: /2022/09/18/8051-assembly-code/

---
**Blink an led with delay**

```
org 00h
main:	mov A,#0FFh
here:	mov P1,A
acall delay
mov P1,#0FEH
acall delay
sjmp heredelay:
mov R0,#0FH
outer:	mov R1,#0FH
inner:	DJNZ R1,inner
DJNZ R0,outer
Ret
End
```

**up/ down counter -- use same program just inc or dec to get up/down**

```
         org 00h
main:	 mov A,#0FFh
here:    mov P1,A
         acall delay
         dec A
         sjmp here
delay: mov R0,#0FH
outer: mov R1,#0FH
inner: DJNZ R1,inner
       DJNZ R0,outer
       Ret
       End
```

**Write '1' seven segment display**

```
ORG 00h
MAIN:	SETB p0.7 ;make cs of decoder high
SETB p3.3
SETB p3.4
mov A,#00000110b
CPL A
mov p1,A
sjmp MAIN
end
```

**Up counting with & segment display**

Refer these for RAM and ROM memory organisation in 8051 : [link 1](https://technobyte.org/8051-external-memory-interfacing-ram-rom/) [link2](https://technobyte.org/8051-memory-ram-rom-structure/)

refer [this](https://www.electronics-tutorials.ws/blog/7-segment-display-tutorial.html) link to know more about 7 segment led display

```
ORG 00h
main: 	SETB p3.3
SETB p3.4
SETB P0.7
init:	mov dptr,#LUT
mov R0,#0AH
loop:	clr A
MOVC A,@A+dptr
mov p1,a
inc dptr
djnz R0,loop
sjmp init
delay: mov R0,#0FH
outer: mov R1,#0FH
inner: DJNZ R1,inner
DJNZ R0,outer
Ret
ORG 0200hLUT: DB 0c0h,0f9h,0a4h,0b0h,99h,92h,82h,0f8h,80h,90h
END
```

**Timer in polling method:**

Use this [link](https://www.engineersgarage.com/timers-8051-timer-programming/) or [this](https://openlabpro.com/guide/timers-8051/) as a reference, keep in mind there are **two 16-bit (THx TLx) in 8051** which are set and **controlled by 2 registers namely TMOD and TCON.**

**TIMER MODE 0 (13 bit mode)** MODE 0 is a 13 bit mode. In this mode the THx acts as an 8 bit timer & TLx acts as a 5 bit timer. The TLx counts up to 31 & then resets to 00 & increment THx by 1. Suppose you load 0 in the timer then the timer will overflow in 2^13 i.e. 8192 machine cycles.

**TIMER MODE 1 (16-bit mode)** MODE 1 is similar to MODE 0 except it is a 16-bit mode. In this mode, the THx & TLx both acts as an 8-bit timer. The TLx counts up to 255 & then resets to 00 & increment THx by 1. Since this is a full 16-bit timer we can get a maximum of 2^16 i.e. 65536 Machine cycle before the timer overflows.

**TIMER MODE 2 (8-bit mode)** In this Mode TLx acts as the timer & THx contains the Reload Value i.e. THx is loaded in TLx every time it overflows i.e. when TLx reaches 255 & is incremented then instead of resetting it to 0 it will be reset to the value stored in THx. This mode is very commonly used for generating baud rate used in serial communication.

**TIMER MODE 3 (Split Mode)** Timer mode “3” is known as a split-timer mode. Timers 0 and 1 may be programmed to be in mode 0, 1, or 2 independently of a similar mode for the other timer. But in mode 3 the timers do not operate independently if mode 3 is chosen for timer 0. When Timer 0 is placed in mode 3, it essentially becomes two separate 8-bit timers. Timer 0 is TL0 and Timer 1 is TH0. Both timers count from 0 to 255 and overflow back to 0. All the bits that are related to Timer 1 will now be tied to TH0. Now placing timer 1 in mode 3 causes it to stop counting, the control bit TR1 and the Timer 1 flag TF1 are now used by timer 0. So even if you use Timer 1 in Mode 0, 1 or 2 you won’t be able to START or STOP the timer & no INTERRUPT will be generated by Timer 1. The real Timer 1 will be incremented every machine cycle no matter what.

**Steps to follow**:(using mode 01 )

1. Configure TMOD
1. load THx TLx with value for timer
1. start timer using TCON
1. keep checking timer Overflow flag and exit if Overflow
1. clear overflow flag and timer using TCON, to start the timer repeat steps 2-5

**assembly code:**

```
        org 0000h
main:	acall timer_setup
        mov p1,#00h
loop:	acall blink
        sjmp loop
blink:	CPL P1.0
        acall delay
        ret
timer_setup:	mov TMOD,#01h
                MOV TH0,#03CH
                MOV TL0,#0B0H
                ret
 delay:	setb tr0      ; start timer0 TR0 set
 here:	JNB tf0,here  ; loop if the falg is not set
        clr tr0
        clr tf0
        ret
```

**Counter in polling**

To setup counter set C/t\`= 1 , select appropriate mode and for counter 1, counter 0 the external pulses are taken from pins **p3.5 p3.4** respectively.

**assembly code:**

```
        org 0000h
main:	mov th0,#00h
        mov tl0,#00h
        mov tmod,#0feh
        setb p3.4 ;input
        setb tr0
here:	jnb tf0,here
        clr tf0
        clr tr0
        end
```

**Interupts:**

two types internal/external, total 4 interrupts in 8051

We will use the external interrupt to do some basic testing

```
org 0000h
ljmp main
org 0003h
ljmp isr
org 0060h
isr:	inc r3
reti
main:	setb p3.2
setb p3.3
Mov IE,#81h
mov r3,#00h
here:
mov p1,#00h
acall delay
mov p1,#0FFh
sjmp here
delay:  mov r0,#0DEh
mov r1,#0CDh
loop1:
dec r1
mov r0,#0DEh
loop2:  djnz r0,loop2
sjmp loop1				end
```

**Timer in interrupt mode**

```
org 00h ; timer using interupt
ljmp main
org 000BH
ljmp isr
isr: clr tr0
mov th0,#03ch;load values to timer 0
mov tl0,#0b0h
clr	tf0
setb tr0
cpl p1.0
reti
org 0200h
main:	mov tmod,#01h;configure timer 0 , 16bit mode
mov IE,#082H ; enable all inetrrupts
mov th0,#03ch;load values to timer 0
mov tl0,#0b0h
mov p1,#00h
mov tcon,#03h
setb tr0
here:	sjmp here
end
```

reference: [datasheet](http://ww1.microchip.com/downloads/en/devicedoc/doc4383.pdf)

**Really good video explanation on basics of 8051 in** **_Malayalam_**

https://youtube.com/playlist?list=PLpOlX5FjW5ZBDciqyfzkmbK6USWAH-Q3D

**Really good videos on 8051 in _English_**

https://youtu.be/9hxhFqJWBZ8

```

```
